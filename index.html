<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remake Productivity Timer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Dark background for high contrast */
        }
        .timer-display {
            font-size: 5rem; /* Large font for visibility */
            font-weight: 900;
            letter-spacing: -2px;
            color: #e94560; /* Accent color for time */
            transition: font-size 0.2s;
        }
        .time-input {
            width: 5rem;
            text-align: center;
        }
        /* Custom ring focus color for accessibility */
        .ring-focus:focus {
            --tw-ring-color: #53bf9d;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-sm md:max-w-md bg-gray-800 p-8 rounded-3xl shadow-2xl space-y-8">
        
        <!-- Settings Toggle -->
        <div class="flex justify-end">
            <button id="settings-btn" class="text-gray-400 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </div>

        <!-- Mode Selector -->
        <div class="flex justify-center space-x-2 text-white">
            <button id="mode-timer-btn" onclick="switchMode('timer')" class="px-4 py-2 text-lg font-semibold rounded-t-xl transition-colors duration-200 border-b-4 border-transparent text-gray-400">
                Timer
            </button>
            <button id="mode-stopwatch-btn" onclick="switchMode('stopwatch')" class="px-4 py-2 text-lg font-semibold rounded-t-xl transition-colors duration-200 border-b-4 border-transparent text-gray-400">
                Stopwatch
            </button>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="hidden bg-gray-900 p-4 rounded-lg mt-4">
            <h3 class="text-lg font-semibold text-white mb-2">Settings</h3>
            <div class="flex items-center justify-between">
                <label for="alarm-sound" class="text-gray-400">Alarm Sound</label>
                <select id="alarm-sound" class="bg-gray-700 text-white p-2 rounded-lg border border-gray-600">
                    <!-- Options will be populated by JavaScript -->
                </select>
                <button id="test-audio-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl">
                    Test
                </button>
            </div>
        </div>

        <h1 class="text-3xl font-bold text-center text-white mb-6">
            Timer V2
        </h1>

        <!-- Timer Display Area -->
        <div id="timer-display" class="timer-display text-center rounded-xl bg-gray-900 p-6 shadow-inner border-4 border-gray-700 select-none">
            25:00
        </div>

        <!-- Controls Area (Presets and Custom Input - Hidden in Stopwatch mode) -->
        <div id="controls-area" class="flex flex-col space-y-4 transition-all duration-300">
            <div class="flex justify-center space-x-3">
                <button onclick="setPreset(25)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition duration-150 active:scale-95 text-sm">
                    25 Min
                </button>
                <button onclick="setPreset(5)" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition duration-150 active:scale-95 text-sm">
                    5 Min Break
                </button>
                <button onclick="setPreset(15)" class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition duration-150 active:scale-95 text-sm">
                    15 Min Break
                </button>
            </div>

            <div class="flex items-center justify-center space-x-2 text-white text-sm">
                <label for="customMinutes" class="text-gray-400">Set Custom Time (min):</label>
                <input id="customMinutes" type="number" value="25" min="1" class="time-input bg-gray-700 text-white p-2 rounded-lg border border-gray-600 ring-focus focus:ring-2 focus:ring-green-500 focus:border-transparent transition" onchange="updateCustomTime()">
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="flex justify-center space-x-4">
            <button id="start-btn" onclick="handleStartPause()" class="flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-extrabold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-105 active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
                Start
            </button>
            
            <button id="reset-btn" onclick="handleReset()" class="flex items-center justify-center bg-red-500 hover:bg-red-600 text-white font-extrabold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-105 active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H8a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm-1 9a1 1 0 011 1v2.101a7.002 7.002 0 0011.601-2.566 1 1 0 111.885-.666A5.002 5.002 0 0014.001 13H12a1 1 0 110-2h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h2.001a7.002 7.002 0 01-11.601-2.566 1 1 0 11-1.885.666z" clip-rule="evenodd" />
                </svg>
                Reset
            </button>

            <button id="lap-btn" onclick="handleLap()" class="flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-extrabold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-105 active:scale-95 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 10.586V7z" clip-rule="evenodd" />
                </svg>
                Lap
            </button>
        </div>

        <!-- Status Message Box -->
        <div id="status-message" class="text-center text-gray-300 min-h-[1.5rem] mt-4">
            Ready to focus?
        </div>

        <!-- Laps Display -->
        <div id="laps-area" class="hidden w-full max-w-sm md:max-w-md bg-gray-800 p-4 rounded-xl shadow-inner mt-4">
            <h3 class="text-lg font-semibold text-white text-center mb-2">Laps</h3>
            <ol id="laps-list" class="list-decimal list-inside text-gray-300 space-y-1 overflow-y-auto max-h-40">
                <!-- Lap times will be inserted here -->
            </ol>
        </div>

    </div>

    <script>
        // --- Timer Variables and State ---
        let totalSeconds = 25 * 60; // Countdown seconds
        let defaultSeconds = 25 * 60;
        let stopwatchSeconds = 0; // Stopwatch seconds
        let timerInterval = null;
        let isRunning = false;
        let currentMode = 'timer'; // 'timer' or 'stopwatch'
        let laps = [];
        
        // --- DOM Elements ---
        const display = document.getElementById('timer-display');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const controlsArea = document.getElementById('controls-area');
        const customMinutesInput = document.getElementById('customMinutes');
        const statusMessage = document.getElementById('status-message');
        const modeTimerBtn = document.getElementById('mode-timer-btn');
        const modeStopwatchBtn = document.getElementById('mode-stopwatch-btn');
        const lapBtn = document.getElementById('lap-btn');
        const lapsArea = document.getElementById('laps-area');
        const lapsList = document.getElementById('laps-list');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const alarmSoundSelect = document.getElementById('alarm-sound');
        const testAudioBtn = document.getElementById('test-audio-btn');

        const alarmSounds = {
            'default': [
                { type: 'sine', frequency: 880, duration: 0.15, delay: 0 },
                { type: 'sine', frequency: 660, duration: 0.15, delay: 0.2 }
            ],
            'highPitch': [
                { type: 'triangle', frequency: 1200, duration: 0.1, delay: 0 },
                { type: 'triangle', frequency: 1200, duration: 0.1, delay: 0.15 }
            ],
            'quickChime': [
                { type: 'square', frequency: 1046.50, duration: 0.08, delay: 0 }, // C6
                { type: 'square', frequency: 1396.91, duration: 0.08, delay: 0.1 }, // F6
                { type: 'square', frequency: 1567.98, duration: 0.08, delay: 0.2 }  // G6
            ]
        };

        function playAlarm() {
            const selectedSound = alarmSoundSelect.value;
            const soundSequence = alarmSounds[selectedSound];

            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) {
                console.error("Web Audio API not supported.");
                return;
            }

            try {
                const audioCtx = new AudioContext();
                const gainNode = audioCtx.createGain();
                gainNode.connect(audioCtx.destination);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);

                soundSequence.forEach(note => {
                    const oscillator = audioCtx.createOscillator();
                    oscillator.type = note.type;
                    oscillator.frequency.setValueAtTime(note.frequency, audioCtx.currentTime + note.delay);
                    oscillator.connect(gainNode);
                    oscillator.start(audioCtx.currentTime + note.delay);
                    oscillator.stop(audioCtx.currentTime + note.delay + note.duration);
                });

            } catch (e) {
                console.error("Could not play alarm sound:", e);
            }
        }

        /**
         * Generic function to update the time display based on the current mode.
         */
        function updateDisplay() {
            let secondsTotal = currentMode === 'timer' ? totalSeconds : stopwatchSeconds;
            
            const hours = Math.floor(secondsTotal / 3600);
            const minutes = Math.floor((secondsTotal % 3600) / 60);
            const seconds = secondsTotal % 60;

            let formattedTime;
            // Display HH:MM:SS if hours > 0, otherwise MM:SS
            if (hours > 0) {
                formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                display.style.fontSize = '4rem'; // Adjust size for HH:MM:SS to fit
            } else {
                formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                display.style.fontSize = '5rem'; // Default large size
            }
            
            display.textContent = formattedTime;
        }

        /**
         * Updates the state of control buttons and styles based on the mode.
         */
        function updateState() {
            // Mode buttons styling
            modeTimerBtn.classList.remove('border-red-500', 'text-white');
            modeStopwatchBtn.classList.remove('border-red-500', 'text-white');
            modeTimerBtn.classList.add('text-gray-400');
            modeStopwatchBtn.classList.add('text-gray-400');

            if (currentMode === 'timer') {
                modeTimerBtn.classList.add('border-red-500', 'text-white');
                controlsArea.classList.remove('hidden');
                lapBtn.classList.add('hidden');
                lapsArea.classList.add('hidden');
            } else { // stopwatch
                modeStopwatchBtn.classList.add('border-red-500', 'text-white');
                controlsArea.classList.add('hidden');
                lapBtn.classList.remove('hidden');
                lapsArea.classList.remove('hidden');
            }

            // Control buttons availability
            if (isRunning) {
                startBtn.textContent = 'Pause';
                startBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                startBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            } else {
                startBtn.textContent = 'Start';
                startBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                startBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            }
            startBtn.disabled = false;
            
            if (currentMode === 'timer') {
                // Reset is available unless timer is stopped at the default time
                resetBtn.disabled = (totalSeconds === defaultSeconds && !isRunning); 
            } else { // stopwatch
                // Reset is available unless stopwatch is stopped at 00:00
                resetBtn.disabled = (stopwatchSeconds === 0 && !isRunning);
                lapBtn.disabled = !isRunning;
            }
        }

        /**
         * Switches between Timer and Stopwatch modes.
         */
        function switchMode(newMode) {
            if (newMode === currentMode) return;
            
            if (isRunning) {
                handleStartPause(); // Pause the currently running timer/stopwatch
            }
            currentMode = newMode;
            
            // Set initial state for the new mode
            if (currentMode === 'timer') {
                statusMessage.textContent = 'Timer mode activated. Ready to countdown.';
                // Ensure countdown is reset to default time
                resetCountdown();
            } else {
                statusMessage.textContent = 'Stopwatch mode activated. Ready to count up.';
                // Ensure stopwatch is reset to 0
                resetStopwatch();
            }
            updateState();
        }


        // --- GENERIC CONTROL HANDLERS ---

        function handleStartPause() {
            if (isRunning) {
                // Pause logic
                clearInterval(timerInterval);
                isRunning = false;
                statusMessage.textContent = 'Paused. Ready to resume?';
            } else {
                // Start logic
                if (currentMode === 'timer') {
                    startCountdown();
                } else {
                    startStopwatch();
                }
            }
            updateState();
        }

        function handleReset() {
            if (currentMode === 'timer') {
                resetCountdown();
            } else {
                resetStopwatch();
            }
        }

        function handleLap() {
            if (!isRunning) return;

            const lapTime = stopwatchSeconds;
            laps.push(lapTime);

            const li = document.createElement('li');
            li.textContent = `Lap ${laps.length}: ${formatTime(lapTime)}`;
            lapsList.appendChild(li);
        }

        function formatTime(secondsTotal) {
            const hours = Math.floor(secondsTotal / 3600);
            const minutes = Math.floor((secondsTotal % 3600) / 60);
            const seconds = secondsTotal % 60;

            if (hours > 0) {
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            } else {
                return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
        }

        // --- COUNTDOWN TIMER LOGIC ---

        function startCountdown() {
            if (totalSeconds <= 0) {
                 statusMessage.textContent = 'Time must be set before starting.';
                 return;
            }

            isRunning = true;
            statusMessage.textContent = 'Focus time started! Keep pushing.';
            updateState();

            timerInterval = setInterval(() => {
                if (totalSeconds <= 0) {
                    clearInterval(timerInterval);
                    isRunning = false;
                    
                    // Trigger the alarm sound
                    playAlarm(); 
                    
                    statusMessage.textContent = 'Timeâ€™s up! Take a well-deserved break.';
                    display.classList.add('bg-green-800', 'text-white');
                    display.classList.remove('bg-gray-900', 'text-red-500');
                    updateState();
                    return;
                }
                
                totalSeconds--;
                updateDisplay();
            }, 1000);
        }

        function resetCountdown() {
            clearInterval(timerInterval);
            isRunning = false;
            totalSeconds = defaultSeconds;
            
            // Remove the 'time up' style
            display.classList.remove('bg-green-800', 'text-white');
            display.classList.add('bg-gray-900', 'text-red-500');

            updateDisplay();
            statusMessage.textContent = 'Timer reset.';
            updateState();
        }

        // --- STOPWATCH LOGIC ---

        function startStopwatch() {
            isRunning = true;
            statusMessage.textContent = 'Stopwatch running.';
            updateState();

            timerInterval = setInterval(() => {
                stopwatchSeconds++;
                updateDisplay();
            }, 1000);
        }

        function resetStopwatch() {
            clearInterval(timerInterval);
            isRunning = false;
            stopwatchSeconds = 0;
            laps = [];
            lapsList.innerHTML = '';
            
            // Ensure display styles are reset
            display.classList.remove('bg-green-800', 'text-white');
            display.classList.add('bg-gray-900', 'text-red-500');

            updateDisplay();
            statusMessage.textContent = 'Stopwatch reset.';
            updateState();
        }


        // --- PRESET/CUSTOM LOGIC (only affects Timer mode) ---
        
        /**
         * Sets the timer to a specific minute preset.
         */
        function setPreset(minutes) {
            if (isRunning) {
                handleStartPause();
            }
            
            // Set new default and total time for the Countdown Timer
            defaultSeconds = minutes * 60;
            totalSeconds = defaultSeconds;
            
            // Update the custom input to reflect the preset
            customMinutesInput.value = minutes;

            resetCountdown(); 
            statusMessage.textContent = `Set to ${minutes} minutes. Ready!`;
        }

        /**
         * Updates the default time based on the custom input field.
         */
        function updateCustomTime() {
            const minutes = parseInt(customMinutesInput.value);
            if (isNaN(minutes) || minutes <= 0) {
                customMinutesInput.value = Math.max(1, defaultSeconds / 60); 
                return;
            }

            setPreset(minutes);
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Populate alarm sound options
            for (const sound in alarmSounds) {
                const option = document.createElement('option');
                option.value = sound;
                option.textContent = sound.charAt(0).toUpperCase() + sound.slice(1);
                alarmSoundSelect.appendChild(option);
            }

            // Settings panel toggle
            settingsBtn.addEventListener('click', () => {
                settingsPanel.classList.toggle('hidden');
            });

            // Test audio button
            testAudioBtn.addEventListener('click', () => {
                playAlarm();
            });

            // Initialize in Timer mode
            switchMode('timer'); 
            
            // Ensure the input value matches the starting default
            customMinutesInput.value = defaultSeconds / 60;
        });
    </script>
</body>
</html>
